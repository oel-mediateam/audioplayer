/* global MediaElementPlayer */$(document).ready(function(){function c(e){var s;n={};n.name=$(e).find("album").find("name").text();n.author=$(e).find("album").find("author").text();n.image=$(e).find("album").find("image").text();n.length=$(e).find("album").find("length").text();$(document).attr("title",n.name);s=$(e).find("tracks").find("track");i=[];s.each(function(){r={};r.id=o;r.source=$(this).find("source").text();r.title=$(this).find("title").text();r.author=$(this).find("author").text().length<=0?n.author:$(this).find("author").text();r.image=$(this).find("image").text().length<=0?n.image:$(this).find("image").text();i[o]=r;o++});if(i.length>1){for(var c=0;c<i.length;c++)if(a===!0){$("#selectable").html('<li class="ui-widget-content" title="'+i[c].title+'">'+'<div style="width:10%;padding:0px 1%;text-align:right;float:left;">'+(i[c].id+1<10?"0"+(i[c].id+1):i[c].id+1)+'.</div><div style="width:86%;padding:0px 1%;float:left;">'+i[c].title+"</div></li>");a=!1}else $("#selectable").append('<li class="ui-widget-content" title="'+i[c].title+'">'+'<div style="width:10%;padding:0px 1%;text-align:right;float:left;">'+(i[c].id+1<10?"0"+(i[c].id+1):i[c].id+1)+'.</div><div style="width:86%;padding:0px 1%;float:left;">'+i[c].title+"</div></li>");$("#selectable li:first").addClass("ui-selected");$("#selectable").selectable({stop:function(){$(".ui-selected",this).each(function(){f=$("#selectable li").index(this)});if(f!==l){v(t,f);l=f}}});h()}else{$(".currentTrackNum").hide();$(".playerPlaylist").hide();$("#audioPlayerWrapper").show();u=!1;p()}}function h(){var e=new Image;$(".album_name").html(n.name);$(".album_author").html(n.author);n.length<=0?$(".album_length").hide():$(".album_length").html(n.length);$(e).load(function(){$("#coverImage").css("background-image","url(assets/images/splash.jpg)")}).error(function(){$("#coverImage").css("background-image","url(https://mediastreamer.doit.wisc.edu/uwli-ltc/media/mp3_player/sources/images/default_cover.jpg)")}).attr({src:"assets/images/splash.jpg",border:0});$("#coverImage").click(function(){var e=navigator.userAgent,t={iphone:e.match(/(iPhone|iPod|iPad)/),blackberry:e.match(/BlackBerry/),android:e.match(/Android/)},n=b("m")==="0"?!1:!0;if((t.iphone||t.ipod||t.ipad||t.blackberry||t.android)&&n){var r=window.location.href,i,s=r.indexOf(".");i=r.substr(s);r="http://webstreamer"+i+"?m=0";window.open(r)}else{$("#coverImage").hide();$("#audioPlayerWrapper").fadeIn();u=!0;p()}});$("#coverImage").show()}function p(){g(0);$(".player").html('<audio id="ap" src="assets/audio/'+i[0].source+'"  '+(u?'autoplay="autoplay"':"")+' preload="metadata" controls></audio>');e=new MediaElementPlayer("#ap",{audioWidth:380,audioHeight:30,startVolume:.8,loop:!1,enableAutosize:!0,features:["playpause","current","progress","duration","volume"],alwaysShowControls:!1,iPadUseNativeControls:!1,iPhoneUseNativeControls:!1,AndroidUseNativeControls:!1,alwaysShowHours:!1,showTimecodeFrameCount:!1,framesPerSecond:25,enableKeyboard:!0,pauseOtherPlayers:!0,success:function(e){e.addEventListener("loadedmetadata",function(){t=e;$(".duration").html(m(e.duration,!1,25))},!1);e.addEventListener("ended",function(){d(e)},!1)}})}function d(e){f++;if(i.length>1&&f<i.length){l=f;g(f);e.setSrc("assets/audio/"+i[f].source);e.load();e.play()}else if(f>=i.length){f=0;g(f);e.setSrc("assets/audio/"+i[f].source);e.load();e.pause();$(".playerPlaylist").animate({scrollTop:0},1e3)}else e.pause();$("#selectable li").each(function(){$(this).removeClass("ui-selected")});$("#selectable li:nth-child("+Number(f+1)+")").addClass("ui-selected");f>=4&&f<i.length&&$(".playerPlaylist").animate({scrollTop:$("#selectable li:nth-child("+Number(f+1)+")").offset().top},500)}function v(e,t){g(t);e.pause();e.setSrc("assets/audio/"+i[t].source);e.load();e.play()}function m(e,t){var n=Math.floor(e/3600)%24,r=Math.floor(e/60)%60,i=Math.floor(e%60),s=(t||n>0?(n<10?"0"+n:n)+":":"")+(r<10?"0"+r:r)+":"+(i<10?"0"+i:i);return s}function g(e){$(".currentTrackNum").html(i[e].id+1);$(".title").html(i[e].title);$(".author").html(i[e].author);s=new Image;$(s).load(function(){$(".image").html(s)}).error(function(){$(".image").html('<img src="sources/images/default_profile.jpg" width="60" height="60" border="0" alt="" />')}).attr({src:"assets/images/"+i[e].image,border:0})}function y(e,t){var n,r;e===0?n="<strong>Error 0</strong> - Not connect. Please verify network.":e===404?n="<strong>Error 404</strong> - Requested page not found or not acceptable.":e===406?n="<strong>Error 406</strong> - Not acceptable error.":e===500?n="<strong>Error 500</strong> - Internal Server Error.":n="Unknow error";t==="parsererror"?r="Requested XML parse failed.":t==="timeout"?r="Time out error.":t==="abort"?r="Ajax request aborted.":t==="error"?r="HTTP / URL Error (most likely a 404 or 406).":r="Uncaught Error.\n"+e.responseText;$("#audioPlayerWrapper").hide();$("#errorMsg").html("<p>"+n+"<br />"+r+"</p>")}function b(e){var t="[\\?&]"+e+"=([^&#]*)",n=new RegExp(t),r=n.exec(window.location.href);e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");return r===null?"":decodeURIComponent(r[1].replace(/\+/g," "))}var e,t,n,r,i,s,o=0,u=!0,a=!0,f=0,l=0;$.ajaxSetup({url:"assets/tracks.xml",type:"GET",dataType:"xml",accepts:"xml",content:"xml",contentType:'xml; charset="utf-8"',cache:!1});$.ajax({encoding:"UTF-8",beforeSend:function(e){e.overrideMimeType("xml; charset=utf-8");e.setRequestHeader("Accept","text/xml")},success:function(e){$("#errorMsg").hide();c(e)},error:function(e,t){y(e.status,t)}})});