/*
 * HTML5 MP3 Audio Player
 *
 * @author: Ethan Lin
 * @url: https://github.com/oel-mediateam/audioplayer
 * @version: 1.0.2
 *
 * @license: The MIT License (MIT)
 * Copyright (c) 2014 UW-EX CEOEL
 *
 */
var ROOT_PATH="https://media.uwex.edu/app/audio_player_v1/";$(document).ready(function(){function e(e){var r;if(d(),p={},p.name=$(e).find("album").find("name").text(),p.author=$(e).find("album").find("author").text(),p.image=$(e).find("album").find("image").text(),p.length=$(e).find("album").find("length").text(),$(document).attr("title",p.name),r=$(e).find("tracks").find("track"),f=[],r.each(function(){h={},h.id=b,h.source=$(this).find("source").text(),h.title=$(this).find("title").text(),h.author=$(this).find("author").text().length<=0?p.author:$(this).find("author").text(),h.image=$(this).find("image").text().length<=0?p.image:$(this).find("image").text(),f[b]=h,b++}),$(".playerInfoPanel").append('<div id="download_bar"><ul></ul></div>'),f.length>1){for(var o=0;o<f.length;o++)y===!0?($("#selectable").html('<li class="ui-widget-content" title="'+f[o].title+'"><div style="width:10%;padding:0px 1%;text-align:right;float:left;">'+(f[o].id+1<10?"0"+(f[o].id+1):f[o].id+1)+'.</div><div style="width:86%;padding:0px 1%;float:left;">'+f[o].title+"</div></li>"),y=!1):$("#selectable").append('<li class="ui-widget-content" title="'+f[o].title+'"><div style="width:10%;padding:0px 1%;text-align:right;float:left;">'+(f[o].id+1<10?"0"+(f[o].id+1):f[o].id+1)+'.</div><div style="width:86%;padding:0px 1%;float:left;">'+f[o].title+"</div></li>");$("#selectable li:first").addClass("ui-selected"),$("#selectable").selectable({stop:function(){$(".ui-selected",this).each(function(){x=$("#selectable li").index(this)}),x!==w&&(i(u,x),w=x)}}),t(),s(m,"zip")}else $(".currentTrackNum").hide(),$(".playerPlaylist").hide(),$("#audioPlayerWrapper").show(),v=!1,a(),s(f[0].source.replace(".mp3",""),"mp3");s(m,"pdf")}function t(){var e=new Image;$(".album_name").html(p.name),$(".album_author").html(p.author),p.length<=0?$(".album_length").hide():$(".album_length").html(p.length),$(e).load(function(){$("#coverImage").css("background-image","url(assets/images/splash.jpg)")}).error(function(){$("#coverImage").css("background-image","url("+ROOT_PATH+"images/default_cover.jpg)")}).attr({src:"assets/images/splash.jpg",border:0}),$("#coverImage").click(function(){$("#coverImage").hide(),$("#audioPlayerWrapper").fadeIn(),v=!0,a()}),$("#coverImage").show()}function a(){l(0),$(".player").html('<audio id="ap" src="assets/audio/'+f[0].source+'"  '+(v?'autoplay="autoplay"':"")+' preload="metadata" controls></audio>'),c=new MediaElementPlayer("#ap",{audioWidth:380,audioHeight:30,startVolume:.8,loop:!1,enableAutosize:!0,features:["playpause","current","progress","duration","volume"],alwaysShowControls:!1,iPadUseNativeControls:!1,iPhoneUseNativeControls:!1,AndroidUseNativeControls:!1,alwaysShowHours:!1,showTimecodeFrameCount:!1,framesPerSecond:25,enableKeyboard:!0,pauseOtherPlayers:!0,success:function(e){e.addEventListener("loadedmetadata",function(){u=e,$(".duration").html(o(e.duration,!1,25))},!1),e.addEventListener("ended",function(){r(e)},!1)}})}function r(e){x++,f.length>1&&x<f.length?(w=x,l(x),e.setSrc("assets/audio/"+f[x].source),e.load(),e.play()):x>=f.length?(x=0,l(x),e.setSrc("assets/audio/"+f[x].source),e.load(),e.pause(),$(".playerPlaylist").animate({scrollTop:0},1e3)):e.pause(),$("#selectable li").each(function(){$(this).removeClass("ui-selected")}),$("#selectable li:nth-child("+Number(x+1)+")").addClass("ui-selected"),x>=4&&x<f.length&&$(".playerPlaylist").animate({scrollTop:$("#selectable li:nth-child("+Number(x+1)+")").offset().top},500)}function i(e,t){l(t),e.pause(),e.setSrc("assets/audio/"+f[t].source),e.load(),e.play()}function o(e,t){var a=Math.floor(e/3600)%24,r=Math.floor(e/60)%60,i=Math.floor(e%60),o=(t||a>0?(10>a?"0"+a:a)+":":"")+(10>r?"0"+r:r)+":"+(10>i?"0"+i:i);return o}function l(e){$(".currentTrackNum").html(f[e].id+1),$(".title").html(f[e].title),$(".author").html(f[e].author),g=new Image,$(g).load(function(){$(".image").html(g)}).error(function(){$(".image").html('<img src="sources/images/default_profile.jpg" width="60" height="60" border="0" alt="" />')}).attr({src:"assets/images/"+f[e].image,border:0})}function n(e,t){var a,r;a=0===e?"<strong>Error 0</strong> - Not connect. Please verify network.":404===e?"<strong>Error 404</strong> - Requested page not found or not acceptable.":406===e?"<strong>Error 406</strong> - Not acceptable error.":500===e?"<strong>Error 500</strong> - Internal Server Error.":"Unknow error",r="parsererror"===t?"Requested XML parse failed.":"timeout"===t?"Time out error.":"abort"===t?"Ajax request aborted.":"error"===t?"HTTP / URL Error (most likely a 404 or 406).":"Uncaught Error.\n"+e.responseText,$("#audioPlayerWrapper").hide(),$("#errorMsg").html("<p>"+a+"<br />"+r+"</p>")}function s(e,t){var a;"pdf"===t?a="application/pdf":"mp3"===t?(a="audio/mpeg",e="assets/audio/"+e):"zip"===t&&(a="application/zip"),$.ajax({url:e+"."+t,type:"HEAD",dataType:"text",contentType:a,async:!1,beforeSend:function(e){e.overrideMimeType(a),e.setRequestHeader("Accept",a)},success:function(){var a=e,r=$("#download_bar ul");if("http:"!==location.protocol){var i=window.location.href;i=i.substr(0,i.lastIndexOf("/")+1).replace("https","http"),a=i+e}switch(t){case"pdf":r.append('<li><a href="'+a+"."+t+'" target="_blank">Transcript</a></li>');break;case"mp3":case"zip":r.append('<li><a href="'+a+"."+t+'" target="_blank">Audio</a></li>')}},error:function(){}})}function d(){var e=window.location.href,t;t=e.split("?"),t=t[0].split("/"),t=t[t.length-2],m=t}var c,u,p,h,f,m,g,b=0,v=!0,y=!0,x=0,w=0;$.ajaxSetup({url:"assets/tracks.xml",type:"GET",dataType:"xml",accepts:"xml",content:"xml",contentType:'xml; charset="utf-8"',cache:!1}),$.ajax({encoding:"UTF-8",beforeSend:function(e){e.overrideMimeType("xml; charset=utf-8"),e.setRequestHeader("Accept","text/xml")},success:function(t){$("#errorMsg").hide(),e(t)},error:function(e,t){n(e.status,t)}})});