/*
 * Audio Player
 *
 * @author: Ethan Lin
 * @url: https://github.com/oel-mediateam/audioplayer
 * @version: 2.0.0
 *
 * @license: The MIT License (MIT)
 * Copyright (c) 2014 - 2018 Media Serivces
 *
 */
"use strict";// audio player class
function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}var APlayer=
/* */
function(){function e(){_classCallCheck(this,e),
// elements of the audio player
this.el={splash:"#ap-splash",splashTitle:"#ap-splash .cover-info .title",splashSubtitle:"#ap-splash .cover-info .subtitle",splashAuthor:"#ap-splash .cover-info .author",splashLength:"#ap-splash .cover-info .length",startBtn:"#ap-start-btn",resumeBtn:"#ap-resume-btn",dwnldBtn:"#ap-dwnld-btn",dwnldBtnMenu:"#ap-dwnld-btn .dropdown-content",mainDwnldBtn:"#ap-download-cntrl",main:"#ap-main",mainBody:"#ap-main .body",showProfileBtn:"#show-profile",closeOverlayBtn:"#overlay-close-btn",overlayDisplay:"#overlay-content",overlayDisplayContent:"#overlay-content .content",overlayDisplaySpinner:"#overlay-content .spinner",currentPic:".head .track-img button",trackTitle:".track-info .title-wrapper .title",trackAuthor:".track-info .author",currentTrackNum:".track-info .meta .current",totalTracks:".track-info .meta .total",miniDisplay:".track-list .minimized-display",upNextTrack:".track-list .minimized-display .ap_up_next_title",trackList:".track-list .tracks",trackListItem:".track-list .tracks li .ap-track",expandTracksBtn:".track-list .expand-btn",next:"#ap-next",previous:"#ap-previous",warning:"body .warning-msg",captionBtn:"#ap-caption",error:"#ap-error",errorIcon:"#ap-error .icon",errorTitle:"#ap-error .title",errorBody:"#ap-error .body",playerId:"#player",copyright:".copyright p"},// manifest object to hold data from the manifest JSON file
this.manifest={},// album object to hold data from the album XML file
this.album={url:"assets/album.xml",program:{},downloads:[],currentTrack:0,sameAuthor:!0,sameAuthorLoaded:!1,analyticsOn:!1,hasCaption:!1},// holds the reference to the audio player instance
this.player=null,// reference object to hold reference values
this.reference={names:this._parseUri(window.location.href),fileName:"album"},// marquee object to hold start and stop timers
this.marquee={start:null,stop:null},// start the player by loading and getting the manifest
this.getManifest()}// function to get the manifest data and then set the player UIs
return _createClass(e,[{key:"getManifest",value:function e(){var t=this,a=t._selector("#ap-manifest").getAttribute("href");t._requestFile(a,function(e){t.manifest=JSON.parse(e.response),0===t.manifest.ap_root_directory.length&&(t.manifest.ap_root_directory="source/"),t.setUIs()})}// function to set the player UIs from loading the template file and then
// check for support, bind event listners, and get album data
},{key:"setUIs",value:function e(){var r=this,t=r.manifest.ap_root_directory+"script/templates/apui.tpl";r._requestFile(t,function(e){var t=r._selector("body"),a=e.response.replace(/\{([source)]+)\}/gi,r.manifest.ap_root_directory);t.innerHTML+=a,r._checkSupport(),r._setStartResumeListeners(),r._expandDownloadBtnMenu(),r.expandTracksToggle(),r._setShowProfileListener(),r.getAlbum()})}// "private" function to add track list click event listener
},{key:"_trackListItemListener",value:function e(){var t=this,a=t._selector(t.el.trackListItem,!0);Array.prototype.forEach.call(a,function(e){e.addEventListener("click",function(e){"track-download"!==e.target.className&&"svg"!==e.target.nodeName&&"use"!==e.target.nodeName&&(t.album.currentTrack=e.currentTarget.getAttribute("data-index"),t.setTrack(Number(t.album.currentTrack)),e.preventDefault())})})}// "private" function to add expand download button event listeners
},{key:"_expandDownloadBtnMenu",value:function e(){var t=this,a=t._selector(t.el.dwnldBtn),r=a.querySelector("button"),s=t._selector(t.el.dwnldBtnMenu);a.addEventListener("mouseenter",function(){r.setAttribute("aria-expanded",!0),s.setAttribute("aria-expanded",!0)}),a.addEventListener("mouseleave",function(){r.setAttribute("aria-expanded",!1),s.setAttribute("aria-expanded",!1)})}// "private" function to add start and resume click event listeners
},{key:"_setStartResumeListeners",value:function e(){var t=this,a;if(t._selector(t.el.startBtn).addEventListener("click",function(){t.hideSplash(),t.sendEventToGA("StartBtn","click",t.reference.fileName),t.setTrack(t.album.currentTrack)}),Modernizr.localstorage){var r=t._selector(t.el.resumeBtn),s=JSON.parse(window.localStorage.getItem("ap-player"));null!==s&&(1<=s.track||0<s.time)&&(r.style.display="block",r.addEventListener("click",function(){t.sendEventToGA("ResumeBtn","click",t.reference.fileName),t.hideSplash(),t.setTrack(s.track,s.time)}))}}// function to get the data from the album XML file and set the data to it respective UIs and set up the audio player
},{key:"getAlbum",value:function e(){var n=this;n._requestFile(n.album.url,function(e){var t=e.responseXML,a=n._xmlSelector(t,"album"),r=n._xmlSelector(t,"setup"),s=n._xmlSelector(t,"track",!0);// settings
n.album.settings={},n.album.settings.accent=a.getAttribute("accent"),n.album.settings.splashFormat="."+a.getAttribute("splashImgFormat"),n.album.settings.trackImgFormat="."+a.getAttribute("trackImgFormat"),n.album.settings.analytics=a.getAttribute("analytics"),n.album.settings.version=a.getAttribute("xmlVersion"),// setup
n.album.title=n._xmlSelector(r,"title").textContent,n.album.subtitle=n._xmlSelector(r,"subtitle").textContent,n.album.author=n._xmlSelector(r,"author").getAttribute("name"),n.album.authorProfile=n._xmlSelector(r,"author").textContent,n.album.length=n._xmlSelector(r,"length").textContent,// set program
n._isEmpty(r.getAttribute("program"))?void 0!==n.reference.names[3]&&(n.album.program.name=n.reference.names[3].toLowerCase()):n.album.program.name=r.getAttribute("program").toLowerCase(),// set course
n._isEmpty(r.getAttribute("course"))||(n.album.course=r.getAttribute("course")),// track(s)
n.album.tracks=[],Array.prototype.forEach.call(s,function(e){var t={};t.src=e.getAttribute("src"),t.title=e.querySelector("title").innerHTML,t.author=e.querySelector("author").getAttribute("name"),t.authorProfile=e.querySelector("author").innerHTML,n._isEmpty(t.author)&&(t.author=n.album.author),t.author!==n.album.author&&(n.album.sameAuthor=!1),n._isEmpty(t.author)?t.img=n._sanitize(n.album.author)+n.album.settings.trackImgFormat:t.img=n._sanitize(t.author)+n.album.settings.trackImgFormat,n.album.tracks.push(t)}),"on"!==n.album.settings.analytics&&"yes"!==n.album.settings.analytics||n._isEmpty(n.manifest.ap_google_tracking_id)||n.addGATracking(n.manifest.ap_google_tracking_id,n.album.settings.version),n.setData(),n._setupAudioPlayer()})}// function to set track
},{key:"setTrack",value:function e(t,a){a=void 0!==a?a:0;// hold the class
var r=this;// update current track
t=Number(t),r.album.currentTrack=t;// display title
var s=r._selector(r.el.trackTitle),n;// if more than one track
if(s.innerHTML=r.album.tracks[t].title,r._selector(r.el.trackAuthor).innerHTML=r.album.tracks[t].author,// load author picture if the track author is different
r.album.sameAuthor||r._loadAuthorPic(r.album.tracks[t]),// load author picture once if same author
r.album.sameAuthor&&!1===r.album.sameAuthorLoaded&&(r._loadAuthorPic(r.album.tracks[t]),r.album.sameAuthorLoaded=!0),1<r.album.tracks.length){
// display and get current track number
var l,i;r._selector(r.el.currentTrackNum).innerHTML=t+1,r._selector(r.el.totalTracks).innerHTML=r.album.tracks.length;// add active class to current track in list
var o=r._selector(r.el.trackListItem,!0);Array.prototype.forEach.call(o,function(e){e.parentNode.classList.remove("active")}),o[t].parentNode.classList.add("active")}// display next track title
var c=r._selector(r.el.upNextTrack);// play the audio if the player is ready after setting source
if(1<r.album.tracks.length&&t<r.album.tracks.length-1&&(c.innerHTML=r.album.tracks[t+1].title),null!==r.player){r.player.playing&&r.player.stop();var u="assets/audio/"+r.album.tracks[t].src+".vtt";r._fileExists(u,function(e){r.album.hasCaption=e?(r.player.source={type:"video",title:r.album.tracks[t].title,sources:[{src:"assets/audio/"+r.album.tracks[t].src+".mp3",type:"audio/mp3"}],tracks:[{kind:"captions",label:"English",srclang:"en",src:"assets/audio/"+r.album.tracks[t].src+".vtt",default:!0}]},r._closeTrackList(),!0):(r.player.source={type:"video",title:r.album.tracks[t].title,sources:[{src:"assets/audio/"+r.album.tracks[t].src+".mp3",type:"audio/mp3"}]},r._openTrackList(),!1),r.player.on("ready",function(){r._handlePlayerReady(),r.player.play(),r.album.hasCaption&&r.player.toggleCaptions(!0),0<a?document.getElementsByTagName("video")[0].currentTime=a:window.setTimeout(function(){Modernizr.localstorage&&window.localStorage.setItem("ap-player",JSON.stringify({track:t,time:a}))},3e3)})})}// scroll the track title is applicable
r._stopMarquee(s),r._marqueeEl(s)}// "private" function to determind and load the author profile image
},{key:"_loadAuthorPic",value:function e(t){var a=this,r=a._selector(a.el.currentPic),s="assets/images/"+t.img,n=a.manifest.ap_author_directory+a._sanitize(t.author)+a.album.settings.trackImgFormat,l=new Image;l.src=a.manifest.ap_root_directory+"images/pic.png",a._fileExists(s,function(e){e?l.src=s:a._fileExists(n,function(e){e&&(l.src=n)})}),r.innerHTML="",r.appendChild(l)}// function to set the album data to their respective UI elements
},{key:"setData",value:function e(){var p=this,t;// DOM head elements
this._selector("title").innerHTML=this.album.title;// splash screen
var a=this._selector(this.el.splashTitle),r=this._selector(this.el.splashSubtitle),s=this._selector(this.el.splashAuthor),n=this._selector(this.el.splashLength);// load accent
if(a.innerHTML=this.album.title,r.innerHTML=this.album.subtitle,s.innerHTML=this.album.author,n.innerHTML=this.album.length,// splash download menu list
0<p.reference.names.length&&(this.reference.fileName=p.reference.names[p.reference.names.length-1]),Array.prototype.forEach.call(this.manifest.ap_download_files,function(n){var l=p.reference.fileName+"."+n.format;p._fileExists(l,function(e){if(e){var t=document.createElement("a"),a;t.href=l,t.setAttribute("role","menuitem"),t.setAttribute("download",l),t.innerHTML=n.label,t.addEventListener("click",function(){p.sendEventToGA(n.label+"DwnldLink","click",p.reference.fileName)}),p._selector(p.el.dwnldBtnMenu).appendChild(t);var r=p._selector(p.el.dwnldBtn);r.setAttribute("aria-hidden",!1),r.style.display="block";var s={name:n.label,url:l};p.album.downloads.push(s)}})}),this._fileExists("assets/splash"+p.album.settings.splashFormat,function(e){if(e){var t=p._selector(p.el.splash),a=p._selector("head"),r='url("assets/splash"'+p.album.settings.splashFormat+'")';t.style.backgroundImage=r;// change the bg in the ap-main:before as well
var s=document.createElement("style");s.setAttribute("type","text/css"),s.innerHTML="#ap-main:before{background-image: "+r+" !important;}",a.appendChild(s)}else if(!p._isEmpty(p.album.program.name)){var l=p.manifest.ap_splash_directory+p.album.program.name+"/default"+p.album.settings.splashFormat;p._isEmpty(p.album.course)||(l=p.manifest.ap_splash_directory+p.album.program.name+"/"+p.album.course+p.album.settings.splashFormat),p._fileExists(l,function(e){var t="";t=e?l:p.manifest.ap_root_directory+"images/splash.svg";var a=p._selector(p.el.splash),r=p._selector("head"),s='url("'+t+'")';a.style.backgroundImage=s;// change the bg in the ap-main:before as well
var n=document.createElement("style");n.setAttribute("type","text/css"),n.innerHTML="#ap-main:before{background-image: "+s+" !important;}",r.appendChild(n)})}}),!this._isEmpty(p.album.settings.accent)){var l=p._colorContrast(p.album.settings.accent),i=this.manifest.ap_root_directory+"script/templates/accent_css.tpl";this._requestFile(i,function(e){var t=e.response.replace(/\{([accent)]+)\}/gi,p.album.settings.accent);t=t.replace(/\{([accentText)]+)\}/gi,l);var a=p._selector("head"),r=document.createElement("style");r.setAttribute("type","text/css"),r.innerHTML=t,a.appendChild(r)})}// set tracks
if(1<this.album.tracks.length){var h=this._selector(this.el.trackList);Array.prototype.forEach.call(this.album.tracks,function(e,t){var a=document.createElement("li"),r=document.createElement("a");r.classList.add("ap-track"),r.href="javascript:void(0);",r.setAttribute("data-index",t);var s=document.createElement("span");s.classList.add("track-num"),s.innerHTML=t+1+".";var n=document.createElement("span");n.classList.add("track-title-wrapper");var l=document.createElement("span");if(l.classList.add("track-title"),l.setAttribute("title",e.title),l.innerHTML=e.title,n.appendChild(l),!p.album.sameAuthor){var i=document.createElement("img"),o="assets/images/"+p.album.tracks[t].img,c=p.manifest.ap_author_directory+p._sanitize(p.album.tracks[t].author)+p.album.settings.trackImgFormat;i.classList.add("track-img"),i.src=p.manifest.ap_root_directory+"images/pic.png",p._fileExists(o,function(e){e?i.src=o:p._fileExists(c,function(e){e&&(i.src=c)})}),r.appendChild(i)}r.appendChild(s),r.appendChild(n);// download button
var u=document.createElement("a");u.classList.add("track-download"),u.setAttribute("download",e.src+".mp3"),u.href="assets/audio/"+e.src+".mp3",u.setAttribute("role","button"),u.addEventListener("click",function(){p.sendEventToGA(e.src+"TrackDwnldLink","click",p.reference.fileName)});var d=document.createElementNS("http://www.w3.org/2000/svg","svg");d.classList.add("icon"),d.setAttribute("aria-hidden",!0),d.setAttribute("viewbox","0 0 30 30");var m=document.createElementNS("http://www.w3.org/2000/svg","use");m.setAttributeNS("http://www.w3.org/1999/xlink","href",p.manifest.ap_root_directory+"images/icons.svg#icon-download"),d.appendChild(m),u.appendChild(d),r.appendChild(u),a.appendChild(r),h.appendChild(a)}),p._openTrackList(),p._trackListItemListener()}else this._selector(this.el.main).classList.add("single");// copyright
var o=this._selector(this.el.copyright),c,u=(new Date).getFullYear();o.innerHTML+="&copy; "+u+". "+this.manifest.ap_copyright,// program theme
this._setProgram()}// "private" function to setup the audio player settings
},{key:"_setupAudioPlayer",value:function e(){var i=this,t=i.manifest.ap_root_directory+"script/templates/single_plyr_controls.tpl";1<i.album.tracks.length&&(t=i.manifest.ap_root_directory+"script/templates/full_plyr_controls.tpl"),i._requestFile(t,function(e){var t=e.response.replace(/\{([source)]+)\}/gi,i.manifest.ap_root_directory),a=!1;Modernizr.localstorage&&(a=!0),i.player=new Plyr(i.el.playerId,{controls:t,hideControls:!1,autoplay:!1,volume:.8,clickToPlay:!1,fullscreen:{enabled:!1,fallback:!1,iosNative:!1},captions:{active:!0,language:"en",update:!1},resetOnEnd:!0,storage:{enabled:a,key:"plyr"}}),i.player.on("ready",function(){var e=i._selector(".plyr__captions"),t=i._selector(i.el.mainBody).offsetHeight,a=-1*(t-40);e.style.top=a+"px",e.style.height=t+"px";var r=i._selector(i.el.mainDwnldBtn);if(1<i.album.tracks.length){var s=i.album.tracks.length-1,n=i._selector(i.el.next),l=i._selector(i.el.previous);i.album.currentTrack<=0&&(l.setAttribute("disabled",!0),l.classList.add("disabled")),i.album.currentTrack>=s&&(n.setAttribute("disabled",!0),n.classList.add("disabled")),n.addEventListener("click",function(){i.album.currentTrack<s&&(i.album.currentTrack++,i.setTrack(i.album.currentTrack))}),l.addEventListener("click",function(){0<i.album.currentTrack&&(i.album.currentTrack--,i.setTrack(i.album.currentTrack))})}r.addEventListener("click",function(){var e=i._selector(i.el.overlayDisplay),t=i._selector(i.el.overlayDisplayContent),a=i._selector(i.el.closeOverlayBtn),r=document.createElement("h4");r.innerHTML="Downloads",t.appendChild(r);var s=document.createElement("ul");s.classList.add("dwnld-list"),Array.prototype.forEach.call(i.album.downloads,function(e){var t=document.createElement("li"),a=document.createElement("a");a.href=e.url,a.innerHTML=e.name,a.setAttribute("download",e.url),a.addEventListener("click",function(){i.sendEventToGA(e.name+"DwnldLink","click",i.reference.fileName)}),t.appendChild(a),s.appendChild(t)}),t.appendChild(s),e.classList.add("small-overlay"),e.style.display="block",i._fadeIn(e),a.addEventListener("click",function(){i.closeOverlay()},{once:!0})})})})}// "private" function handle player ready event
},{key:"_handlePlayerReady",value:function e(){// check playback rate and update playback rate select element
for(var r=this,t=r._selector("#ap-playpause"),a=r._selector("#ap-muteunmute"),s=r._selector("#ap-playbackRate"),n=r._selector(r.el.captionBtn),l=0;l<s.options.length;l++)if(Number(s.options[l].value)===r.player.speed){s.selectedIndex=l;break}// check caption
0<=r.player.currentTrack?n.classList.add("plyr__control--pressed"):n.classList.remove("plyr__control--pressed"),r.player.on("captionsenabled",function(){n.classList.add("plyr__control--pressed"),1<r.album.tracks.length&&r._closeTrackList()}),r.player.on("captionsdisabled",function(){if(n.classList.remove("plyr__control--pressed"),1<r.album.tracks.length&&r._openTrackList(),Modernizr.localstorage){var e=JSON.parse(window.localStorage.getItem("plyr"));delete e.captions,window.localStorage.setItem("plyr",JSON.stringify(e))}}),r.player.on("playing",function(){t.classList.add("plyr__control--pressed")}),r.player.on("pause",function(){t.classList.remove("plyr__control--pressed"),Modernizr.localstorage&&window.localStorage.setItem("ap-player",JSON.stringify({track:r.album.currentTrack,time:r.player.currentTime}))}),Modernizr.localstorage&&r.player.on("timeupdate",function(){var e=Number(r.album.currentTrack)+1,t=r.player.currentTime,a=t/r.player.duration;3<=t&&t<=4&&r.sendEventToGA("Playback","start",r.reference.fileName+":track"+e),.45<=a&&a<=.5&&(window.localStorage.setItem("ap-player",JSON.stringify({track:r.album.currentTrack,time:r.player.currentTime})),r.sendEventToGA("Playback","halfway",r.reference.fileName+":track"+e))}),// on playback end
r.player.on("ended",function(){var e=Number(r.album.currentTrack)+1;t.classList.contains("plyr__control--pressed")&&t.classList.add("plyr__control--pressed"),Modernizr.localstorage&&window.localStorage.setItem("ap-player",JSON.stringify({track:r.album.currentTrack,time:0})),r.sendEventToGA("Playback","completed",r.reference.fileName+":track"+e),r.player.restart()}),// change playback rate
s.addEventListener("change",function(e){r.player.speed=Number(e.target.options[e.target.selectedIndex].value)}),// toglle mute/unmute state
a.addEventListener("click",function(e){e.target.classList.contains("plyr__control--pressed")?e.target.classList.remove("plyr__control--pressed"):e.target.classList.add("plyr__control--pressed")})}// end player ready event
// "private" function to set program theme bar
},{key:"_setProgram",value:function e(){var t=this;t.manifest.ap_custom_themes&&(t.album.program=t.manifest.ap_custom_themes.find(function(e){return e.name===t.album.program.name}),void 0===t.album.program&&(t.album.program=t.manifest.ap_custom_themes.find(function(e){return e.name===t.manifest.ap_logo_default})));var a=t._selector(".program-theme");t.album.program.colors.forEach(function(e){var t=document.createElement("span");t.style.backgroundColor=e,a.appendChild(t)})}// "private" function to check for core feature support from web browser
},{key:"_checkSupport",value:function e(){this.hasCoreFeaturesSupport()?this.showError("🙈","",'Your web browser does not support core audio player features.<br><a href="http://outdatedbrowser.com/en" target="_blank">Please update your web browser.</a>'):this.hasAppearanceIusses()&&this.showWarning("Your web browser does not support some of the player's features. For better viewing experience, try a different web browser.")}// function to determine the core feature support
},{key:"hasCoreFeaturesSupport",value:function e(){return!!(!Modernizr.audio&&Modernizr.json&&Modernizr.json&&Modernizr.csscalc&&Modernizr.flexbox)}// function to determine any appearance issues
},{key:"hasAppearanceIusses",value:function e(){return!Modernizr.svg||(!Modernizr.cssanimations||(!Modernizr.bgsizecover||!Modernizr.objectfit))}// function to show error
},{key:"showError",value:function e(t,a,r){var s=this._selector(this.el.splash),n=this._selector(this.el.main),l=this._selector(this.el.error),i=this._selector(this.el.errorIcon),o=this._selector(this.el.errorTitle),c=this._selector(this.el.errorBody),u=document.createAttribute("aria-hidden");u.value=!1,i.innerHTML=t,o.innerHTML=a,c.innerHTML=r,s.style.display="none",n.style.display="none",l.style.display="flex",l.setAttributeNode(u),this._fadeIn(l)}// function to show warning
},{key:"showWarning",value:function e(t){var a=this,r=a._selector(a.el.warning),s=1e4;r.innerHTML=t,r.style.display="block",a._fadeIn(r),window.setTimeout(function(){a._fadeOut(r,function(){r.innerHTML="",r.style.display="none"})},s)}// function to hide the splash screen
},{key:"hideSplash",value:function e(){var t=this._selector(this.el.splash),a=document.createAttribute("aria-hidden");a.value=!0,t.classList.add("hide-splash"),t.setAttributeNode(a)}// function to show author profile
},{key:"showProfile",value:function e(){var a=this,t=this._selector(this.el.overlayDisplay),r=this._selector(this.el.closeOverlayBtn),s=Number(a._selector(a.el.currentTrackNum).innerHTML)-1;a.album.tracks.length<=1&&(s=0);var n=a.album.tracks[s].author,l=a.album.authorProfile,i,o;if(a._isEmpty(a.album.tracks[s].authorProfile)||(l=a.album.tracks[s].authorProfile),a._isEmpty(l)){var c=a.manifest.ap_author_directory+a._sanitize(n)+".json?callback=author",u;(i={},o=a._selector(a.el.overlayDisplaySpinner),i.send=function(e,t){o.classList.add("spin");var a=t.callbackName||"callback",r=t.onSuccess||function(){},s=t.onTimeout||function(){},n=t.timeout||10,l=window.setTimeout(function(){window[a]=function(){},o.classList.remove("spin"),s()},1e3*n);// sec
window[a]=function(e){window.clearTimeout(l),o.classList.remove("spin"),r(e)};var i=document.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,document.getElementsByTagName("head")[0].appendChild(i)},i).send(c,{callbackName:"author",onSuccess:function e(t){a._setProfile(t.name,t.profile)},onTimeout:function e(){a._setProfile(n,l)},timeout:5})}else a._setProfile(n,l);t.style.display="block",this._fadeIn(t),r.addEventListener("click",function(){a.closeOverlay()},{once:!0})}// "private" function to set the author profile
},{key:"_setProfile",value:function e(t,a){var r=this._selector(this.el.overlayDisplayContent),s=document.createElement("h4");s.innerHTML=t;var n=document.createElement("div");n.innerHTML=a,r.appendChild(s),r.appendChild(n)}// function to close the overlay screen
},{key:"closeOverlay",value:function e(){var t=this._selector(this.el.overlayDisplay),a=this._selector(this.el.overlayDisplayContent);this._fadeOut(t,function(){t.style.display="",a.innerHTML="",t.classList.remove("small-overlay")})}// function to add event listener to show the profile
},{key:"_setShowProfileListener",value:function e(){var t=this,a;this._selector(this.el.showProfileBtn).addEventListener("click",function(){t.showProfile()})}// function to expand and close the track list
},{key:"expandTracksToggle",value:function e(){var t=this,a;t._selector(this.el.expandTracksBtn).addEventListener("click",function(){var e=t._selector(t.el.trackList);"none"==e.style.display||""==e.style.display?t._openTrackList():t._closeTrackList()})}// "private" functiont to open the track list
},{key:"_openTrackList",value:function e(){var t=this,a=t._selector(t.el.trackList),r=t._selector(t.el.miniDisplay),s=t._selector(this.el.expandTracksBtn);a.style.display="block",r.style.display="none",t._slideDown(s.parentNode,function(){s.classList.add("rotate"),a.style.setProperty("overflow-y","auto")})}// "private" functiont to close the track list
},{key:"_closeTrackList",value:function e(){var t=this,a=t._selector(t.el.trackList),r=t._selector(t.el.miniDisplay),s=t._selector(this.el.expandTracksBtn);a.style.display="none",a.style.setProperty("overflow-y","hidden"),r.style.display="flex",t._slideUp(s.parentNode,function(){s.classList.remove("rotate")})}
/*** HELPER FUNCTIONS ***/},{key:"_selector",value:function e(t,a){return(a="boolean"==typeof a&&a)?document.querySelectorAll(t):document.querySelector(t)}},{key:"_xmlSelector",value:function e(t,a,r){return(r="boolean"==typeof r&&r)?t.querySelectorAll(a):t.querySelector(a)}},{key:"_sanitize",value:function e(t){return t.replace(/[^\w]/gi,"").toLowerCase()}},{key:"_isEmpty",value:function e(t){return"string"==typeof t&&""===t.trim()||(void 0===t||null===t)}},{key:"_requestFile",value:function e(t,a){var r,s=this._selector("body"),n=new XMLHttpRequest;n.open("GET",t,!0),n.onload=function(){200<=this.status&&this.status<400?a(this):s.innerHTML+='<div class="error">Error '+this.status+" while loading <code>"+t+"</code></div>",n.abort()},n.onerror=function(){s.innerHTML+='<div class="error">Connection Error. Check your network.</div>'},n.send()}},{key:"_fileExists",value:function e(t,a){var r=new XMLHttpRequest,s=!1;r.open("HEAD",t,!0),r.onload=function(){s=200<=this.status&&this.status<400,a(s)},r.send()}},{key:"_cleanArray",value:function e(a){return a.forEach(function(e,t){""===e&&a.splice(t,1)}),/(\w*|(\w*\-\w*)*)\.\w*/gi.test(a[a.length-1])&&a.pop(),/(\w*|(\w*\-\w*)*)\:/gi.test(a[a.length-1])&&a.pop(),a}},{key:"_parseUri",value:function e(t){var a,r=t.split("?")[0];return r.lastIndexOf("/")!==r.length-1&&(r+="/"),this._cleanArray(r.split("/"))}},{key:"_colorContrast",value:function e(t){var a=this._hexToRGB(t).split(","),r;return 125<Math.round((299*parseInt(a[0])+587*parseInt(a[1])+114*parseInt(a[2]))/1e3)?"#000":"#fff"}},{key:"_hexToRGB",value:function e(t){t=t.replace(/[^0-9A-F]/gi,"");var a=parseInt(t,16),r,s,n;return[a>>16&255,a>>8&255,255&a].join()}
/*** GOOGLE ANALYTICS METHODS ***/
// function to add google analytics tracking
},{key:"addGATracking",value:function e(t,a){var r,s,n,l,i,o,c;this.album.analyticsOn=!0,r=window,s=document,n="script",l="//www.google-analytics.com/analytics.js",i="ga",r.GoogleAnalyticsObject=i,r.ga=r.ga||function(){(r.ga.q=r.ga.q||[]).push(arguments)},r.ga.l=1*new Date,o=s.createElement(n),c=s.getElementsByTagName(n)[0],o.async=1,o.src=l,c.parentNode.insertBefore(o,c),ga("create",t,"auto"),ga("set",{appName:"Audio Player",appVersion:a}),ga("send","screenview",{screenName:this.reference.fileName})}},{key:"sendEventToGA",value:function e(t,a,r){this.album.analyticsOn&&ga("send","event",t,a,r,1,{screenName:this.reference.fileName})}
/*** ANIMATION METHODS ***/},{key:"_marqueeEl",value:function e(t){var a=this;if(t.offsetWidth<t.scrollWidth){var r=15500,s=5e3;a.marquee.start=window.setInterval(function(){t.parentNode.classList.remove("stop-marquee"),t.parentNode.classList.add("marquee"),t.style.width=t.scrollWidth+"px",window.clearInterval(a.marquee.start),a.marquee.stop=window.setTimeout(function(){t.style.width="initial",t.parentNode.classList.remove("marquee"),window.clearTimeout(a.marquee.stop),a._fadeIn(t),a._marqueeEl(t)},r)},s)}}},{key:"_stopMarquee",value:function e(t){t.style.width="",t.parentNode.classList.remove("marquee"),t.parentNode.classList.add("stop-marquee"),null!==this.marquee.stop&&window.clearTimeout(this.marquee.stop),null!==this.marquee.start&&window.clearInterval(this.marquee.start)}},{key:"_fadeIn",value:function e(t,a){if(t.classList.remove("fadeOut"),t.classList.add("fadeIn"),void 0!==a){var r=this._whichAnimationEvent();t.params={_event:r,_callback:a},t.addEventListener(r,this._fadeCallback)}}},{key:"_fadeOut",value:function e(t,a){if(t.classList.remove("fadeIn"),t.classList.add("fadeOut"),void 0!==a){var r=this._whichAnimationEvent();t.params={_event:r,_callback:a},t.addEventListener(r,this._fadeCallback)}}},{key:"_fadeCallback",value:function e(t){void 0!==t.target.params._callback&&"function"==typeof t.target.params._callback&&t.target.params._callback(),t.target.classList.remove("fadeIn"),t.target.classList.remove("fadeOut"),t.target.removeEventListener(t.target.params._event,this._fadeCallback),t.target.params={_event:"",_callback:""}}},{key:"_slideDown",value:function e(t,a){if(t.classList.add("slideDown"),t.classList.remove("slideUp"),void 0!==a){var r=this._whichAnimationEvent();t.params={_event:r,_callback:a},t.addEventListener(r,this._slideCallback)}}},{key:"_slideUp",value:function e(t,a){if(t.classList.add("slideUp"),t.classList.remove("slideDown"),void 0!==a){var r=this._whichAnimationEvent();t.params={_event:r,_callback:a},t.addEventListener(r,this._slideCallback)}}},{key:"_slideCallback",value:function e(t){void 0!==t.target.params&&("function"==typeof t.target.params._callback&&t.target.params._callback(),t.target.removeEventListener(t.target.params._event,this._slideCallback))}},{key:"_whichAnimationEvent",value:function e(){var t,a=document.createElement("fakeelement"),r={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(t in r)if(void 0!==a.style[t])return r[t]}}]),e}();// end APlayer class
// ON DOM READY
// end APlayer class
// ON DOM READY
!function e(t){(document.attachEvent?"complete"===document.readyState:"loading"!==document.readyState)?t():document.addEventListener("DOMContentLoaded",t)}(function(){new APlayer});
//# sourceMappingURL=audio.js.map
//# sourceMappingURL=audio.js.map