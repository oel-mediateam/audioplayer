/*
 * Audio Player
 *
 * @author: Ethan Lin
 * @url: https://github.com/oel-mediateam/audioplayer
 * @version: 2.0.0
 *
 * @license: The MIT License (MIT)
 * Copyright (c) 2014 - 2018 Media Serivces
 *
 */
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,s,n){return s&&e(t.prototype,s),n&&e(t,n),t}}(),APlayer=function(){function e(){_classCallCheck(this,e),this.el={splash:"#ap-splash",main:"#ap-main",showProfileBtn:"#show-profile",closeProfileBtn:"#author-close-btn",profileDisplay:"#author-overlay",trackTitle:".track-info .title-wrapper .title",miniDisplay:".track-list .minimized-display",trackList:".track-list .tracks",expandTracksBtn:".track-list .expand-btn",ccSpecDisplay:".body .cc-spec-display",spectrumDisplay:".body .cc-spec-display .spectrum",captionDisplay:".body .cc-spec-display .caption",bodyControls:".body .controls",ccToggle:"#cc-toggle",spectrumToggle:"#spectrum-toggle",warning:".body .warning-msg",error:"#ap-error",errorIcon:"#ap-error .icon",errorTitle:"#ap-error .title",errorBody:"#ap-error .body",playerId:"#player",copyright:".copyright p",player:null},this.manifest={},this.album={}}return _createClass(e,[{key:"go",value:function e(){var t=this;if(t.hasCoreFeaturesSupport())return void t.showError("ðŸ™ˆ","",'Your web browser does not support core audio player features.<br><a href="http://outdatedbrowser.com/en" target="_blank">Please update your web browser.</a>');t.hasAppearanceIusses()&&t.showWarning("For better viewing, try a different web browser."),t.getManifest()}},{key:"hasCoreFeaturesSupport",value:function e(){return!!(!Modernizr.audio&&Modernizr.json&&Modernizr.svg&&Modernizr.csscalc&&Modernizr.flexbox)}},{key:"hasAppearanceIusses",value:function e(){return!Modernizr.canvas||(!Modernizr.cssanimations||(!Modernizr.bgsizecover||!Modernizr.objectfit))}},{key:"showError",value:function e(t,s,n){var a=this._selector(this.el.splash),o=this._selector(this.el.main),l=this._selector(this.el.error),i=this._selector(this.el.errorIcon),r=this._selector(this.el.errorTitle),c=this._selector(this.el.errorBody),p=document.createAttribute("aria-hidden");p.value=!1,i.innerHTML=t,r.innerHTML=s,c.innerHTML=n,a.style.display="none",o.style.display="none",l.style.display="flex",l.setAttributeNode(p),this._fadeIn(l)}},{key:"showWarning",value:function e(t){var s=this,n=s._selector(s.el.warning),a=6e3;n.innerHTML=t,n.style.display="block",s._fadeIn(n),window.setTimeout(function(){s._fadeOut(n,function(){n.innerHTML="",n.style.display="none"})},6e3)}},{key:"getManifest",value:function e(){var t=this,s=t._selector("#ap-manifest").getAttribute("href"),n=new XMLHttpRequest;n.open("GET",s,!0),n.onload=function(){this.status>=200&&this.status<400?(t.manifest=JSON.parse(this.response),t.getAlbum()):t.showError("ðŸ¤”",this.status,"Something went wrong while loading manifest.")},n.onerror=function(){t.showError("","Connection Error","Check your network.")},n.send()}},{key:"getAlbum",value:function e(){this.setUIs()}},{key:"setUIs",value:function e(){var t=this,s=t._selector(t.el.trackTitle),n=t._selector(t.el.copyright),a=new Date,o=a.getFullYear();n.innerHTML+="&copy; "+o+". "+t.manifest.ap_copyright,0===t.manifest.ap_root_directory.length&&(t.manifest.ap_root_directory="source/"),this._marqueeEl(s),this._CCSpectrumDisplays(),this._expandTracksToggle(),this._setShowProfileListener(),this._setupAudioPlayer()}},{key:"hideSplash",value:function e(){var t=this._selector(this.el.splash),s=document.createAttribute("aria-hidden");s.value=!0,t.classList.add("hide-splash"),t.setAttributeNode(s)}},{key:"showProfile",value:function e(){var t=this,s=this._selector(this.el.profileDisplay),n=this._selector(this.el.closeProfileBtn);s.style.display="block",this._fadeIn(s),n.addEventListener("click",function(){t.closeProfile()},{once:!0})}},{key:"closeProfile",value:function e(){var t=this._selector(this.el.profileDisplay);this._fadeOut(t,function(){t.style.display=""})}},{key:"_setShowProfileListener",value:function e(){var t=this;this._selector(this.el.showProfileBtn).addEventListener("click",function(){t.showProfile()})}},{key:"_expandTracksToggle",value:function e(){var t=this,s=t._selector(this.el.expandTracksBtn);s.addEventListener("click",function(){var e=t._selector(t.el.trackList),n=t._selector(t.el.miniDisplay);"none"==e.style.display||""==e.style.display?(e.style.display="block",n.style.display="none",t._hideCCSpectrum(),t._slideDown(s.parentNode,function(){s.classList.add("rotate")})):(e.style.display="none",n.style.display="flex",t._slideUp(s.parentNode,function(){s.classList.remove("rotate"),t._CCSpectrumDisplays()}))})}},{key:"_setupAudioPlayer",value:function e(){var t=this,s='\n        <div class="plyr__controls">\n            \n            <div class="top-controls">\n            \n                <div class="plyr__time plyr__time--current" aria-label="Current time">00:00</div>\n                \n                <div class="plyr__progress">\n                    <input id="plyr-seek-{id}" data-plyr="seek" type="range" min="0" max="100" step="0.01" value="0" aria-label="Seek">\n                    <progress class="plyr__progress__buffer" min="0" max="100" value="0" role="presentation" aria-hidden="true">% buffered</progress>\n                    <span role="tooltip" class="plyr__tooltip">00:00</span>\n                </div>\n                \n                <div class="plyr__time plyr__time--duration" aria-label="Duration">00:00</div>\n            \n            </div>\n            \n            <div class="middle-controls">\n                \n                <button type="button" class="plyr__control">\n                    <svg role="presentation"><use xlink:href="'+t.manifest.ap_root_directory+'images/icons.svg#icon-previous"></use></svg>\n                    <span class="plyr__tooltip" role="tooltip">Previous</span>\n                </button>\n                \n                <button type="button" class="plyr__control" data-plyr="rewind">\n                    <svg role="presentation"><use xlink:href="'+t.manifest.ap_root_directory+'images/icons.svg#icon-backward"></use></svg>\n                    <span class="plyr__tooltip" role="tooltip">Rewind {seektime} secs</span>\n                </button>\n                \n                <button type="button" id="ap-playpause" class="plyr__control" aria-label="Play, {title}" data-plyr="play">\n                    <svg class="icon--pressed" role="presentation"><use xlink:href="'+t.manifest.ap_root_directory+'images/icons.svg#icon-pause"></use></svg>\n                    <svg class="icon--not-pressed" role="presentation"><use xlink:href="'+t.manifest.ap_root_directory+'images/icons.svg#icon-play"></use></svg>\n                    <span class="label--pressed plyr__tooltip" role="tooltip">Pause</span>\n                    <span class="label--not-pressed plyr__tooltip" role="tooltip">Play</span>\n                </button>\n                \n                <button type="button" class="plyr__control" data-plyr="fast-forward">\n                    <svg role="presentation"><use xlink:href="'+t.manifest.ap_root_directory+'images/icons.svg#icon-forward"></use></svg>\n                    <span class="plyr__tooltip" role="tooltip">Forward {seektime} secs</span>\n                </button>\n                \n                <button type="button" class="plyr__control">\n                    <svg role="presentation"><use xlink:href="'+t.manifest.ap_root_directory+'images/icons.svg#icon-next"></use></svg>\n                    <span class="plyr__tooltip" role="tooltip">Next</span>\n                </button>\n            \n            </div>\n            \n            <div class="bottom-controls">\n                \n                <button id="ap-loop" type="button" class="plyr__control">\n                    <svg role="presentation"><use xlink:href="'+t.manifest.ap_root_directory+'images/icons.svg#icon-loop"></use></svg>\n                    <span class="plyr__tooltip" role="tooltip">Loop</span>\n                </button>\n                \n                 <select id="ap-playbackRate" name="playback">\n                  <option value="1">1x</option>\n                  <option value="1.5">1.5x</option>\n                  <option value="2">2x</option>\n                  <option value="2.5">2.5x</option>\n                </select> \n                \n                <div class="ap-volcontrols">\n                \n                    <button type="button" id="ap-muteunmute" class="plyr__control" aria-label="Mute" data-plyr="mute">\n                        <svg class="icon--pressed" role="presentation"><use xlink:href="#plyr-muted"></use></svg>\n                        <svg class="icon--not-pressed" role="presentation"><use xlink:href="#plyr-volume"></use></svg>\n                        <span class="label--pressed plyr__tooltip" role="tooltip">Unmute</span>\n                        <span class="label--not-pressed plyr__tooltip" role="tooltip">Mute</span>\n                    </button>\n                    \n                    <div class="plyr__volume">\n                        <input data-plyr="volume" type="range" min="0" max="1" step="0.05" value="1" autocomplete="off" aria-label="Volume">\n                    </div>\n                \n                </div>\n                \n                <button type="button" class="plyr__control">\n                    <svg role="presentation"><use xlink:href="'+t.manifest.ap_root_directory+'images/icons.svg#icon-download"></use></svg>\n                    <span class="plyr__tooltip" role="tooltip">Download</span>\n                </button>\n            \n            </div>\n            \n        </div>\n        ';t.el.player=new Plyr(this.el.playerId,{controls:s,autoplay:!1,volume:.8,clickToPlay:!1,fullscreen:{enabled:!1,fallback:!1,iosNative:!1}}),t.el.player.on("ready",function(e){var s=e.detail.plyr,n=t._selector("#ap-playpause"),a=t._selector("#ap-muteunmute"),o=t._selector("#ap-loop"),l=t._selector("#ap-playbackRate");!0===s.playing&&n.classList.add("plyr__control--pressed");for(var i=0;i<l.options.length;i++)if(Number(l.options[i].value)===s.speed){l.selectedIndex=i;break}s.on("ended",function(){!1===s.loop&&(n.classList.contains("plyr__control--pressed")&&n.classList.add("plyr__control--pressed"),s.restart())}),o.addEventListener("click",function(){!1===s.loop?(s.loop=!0,o.classList.add("active")):(s.loop=!1,o.classList.remove("active"))}),l.addEventListener("change",function(e){s.speed=Number(e.target.options[e.target.selectedIndex].value)}),n.addEventListener("click",function(e){e.target.classList.contains("plyr__control--pressed")?e.target.classList.remove("plyr__control--pressed"):e.target.classList.add("plyr__control--pressed")}),a.addEventListener("click",function(e){e.target.classList.contains("plyr__control--pressed")?e.target.classList.remove("plyr__control--pressed"):e.target.classList.add("plyr__control--pressed")})})}},{key:"toggleCC",value:function e(){var t=this._selector(this.el.captionDisplay),s=this._selector(this.el.spectrumDisplay),n=this._selector(this.el.ccToggle),a=this._selector(this.el.spectrumToggle);n.classList.add("disabled"),a.classList.remove("disabled"),t.classList.add("active"),s.classList.remove("active")}},{key:"toggleSpectrum",value:function e(){var t=this._selector(this.el.captionDisplay),s=this._selector(this.el.spectrumDisplay),n=this._selector(this.el.ccToggle);this._selector(this.el.spectrumToggle).classList.add("disabled"),n.classList.remove("disabled"),s.classList.add("active"),t.classList.remove("active")}},{key:"_CCSpectrumDisplays",value:function e(){var t=this,s=this._selector(this.el.bodyControls),n=this._selector(this.el.ccSpecDisplay),a=this._selector(this.el.ccToggle),o=this._selector(this.el.spectrumToggle);"none"===s.style.display?(s.style.display="",n.style.display=""):t.toggleCC(),a.addEventListener("click",function(){t.toggleCC()}),o.addEventListener("click",function(){t.toggleSpectrum()})}},{key:"_hideCCSpectrum",value:function e(){var t=this._selector(this.el.ccSpecDisplay);this._selector(this.el.bodyControls).style.display="none",t.style.display="none"}},{key:"_selector",value:function e(t){return document.querySelector(t)}},{key:"_marqueeEl",value:function e(t){var s=this;if(t.offsetWidth<t.scrollWidth)var n=15500,a=5e3,o=window.setInterval(function(){t.parentNode.classList.add("marquee"),t.style.width=t.scrollWidth+"px",window.clearInterval(o);var e=window.setTimeout(function(){t.style.width="initial",s._fadeIn(t),t.parentNode.classList.remove("marquee"),window.clearTimeout(e),s._marqueeEl(t)},15500)},5e3)}},{key:"_fadeIn",value:function e(t,s){t.classList.remove("fadeOut"),t.classList.add("fadeIn");var n=this._whichAnimationEvent();t.params={_event:n,_callback:s},t.addEventListener(n,this._fadeCallback)}},{key:"_fadeOut",value:function e(t,s){t.classList.remove("fadeIn"),t.classList.add("fadeOut");var n=this._whichAnimationEvent();t.params={_event:n,_callback:s},t.addEventListener(n,this._fadeCallback)}},{key:"_fadeCallback",value:function e(t){void 0!==t.target.params._callback&&"function"==typeof t.target.params._callback&&t.target.params._callback(),t.target.classList.remove("fadeIn"),t.target.classList.remove("fadeOut"),t.target.removeEventListener(t.target.params._event,this._fadeCallback)}},{key:"_slideDown",value:function e(t,s){t.classList.add("slideDown"),t.classList.remove("slideUp");var n=this._whichAnimationEvent();t.params={_event:n,_callback:s},t.addEventListener(n,this._slideCallback)}},{key:"_slideUp",value:function e(t,s){t.classList.add("slideUp"),t.classList.remove("slideDown");var n=this._whichAnimationEvent();t.params={_event:n,_callback:s},t.addEventListener(n,this._slideCallback)}},{key:"_slideCallback",value:function e(t){void 0!==t.target.params._callback&&"function"==typeof t.target.params._callback&&t.target.params._callback(),t.target.removeEventListener(t.target.params._event,this._slideCallback)}},{key:"_whichAnimationEvent",value:function e(){var t=void 0,s=document.createElement("fakeelement"),n={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(t in n)if(void 0!==s.style[t])return n[t]}}]),e}(),AP=null;!function e(t){(document.attachEvent?"complete"===document.readyState:"loading"!==document.readyState)?t():document.addEventListener("DOMContentLoaded",t)}(function(){AP=new APlayer,AP.go()});
//# sourceMappingURL=./audio.js.map