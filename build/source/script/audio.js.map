{"version":3,"sources":["../../../source/script/audio-dev.js"],"names":["APlayer","_classCallCheck","this","el","splash","splashTitle","splashSubtitle","splashAuthor","splashLength","startBtn","resumeBtn","dwnldBtn","dwnldBtnMenu","main","mainBody","showProfileBtn","closeProfileBtn","profileDisplay","trackTitle","trackAuthor","currentDuration","currentTrackNum","totalTracks","miniDisplay","trackList","expandTracksBtn","ccSpecDisplay","spectrumDisplay","captionDisplay","bodyControls","ccToggle","spectrumToggle","warning","error","errorIcon","errorTitle","errorBody","playerId","copyright","player","manifest","album","url","program","downloads","reference","names","_parseUri","window","location","href","params","URLSearchParams","search","getManifest","self","manifestUrl","_selector","getAttribute","_requestFile","xhr","JSON","parse","response","ap_root_directory","length","setUIs","templateUrl","body","res","replace","innerHTML","getAlbum","_checkSupport","_setStartResumeListeners","_expandDownloadBtnMenu","_CCSpectrumDisplays","_expandTracksToggle","_setShowProfileListener","btn","querySelector","menu","addEventListener","setAttribute","hideSplash","currentTitle","tracks","title","currentAuthor","_isEmpty","author","ready","source","type","sources","src","once","duration","_marqueeEl","xml","responseXML","xmlSettings","_xmlSelector","xmlSetup","xmlTracks","settings","accent","splashFormat","imgFormat","analytics","version","textContent","subtitle","authorProfile","undefined","name","course","Array","prototype","forEach","call","obj","img","push","console","log","setData","_setupAudioPlayer","fileName","ap_download_files","file","format","_fileExists","exist","link","document","createElement","label","appendChild","style","display","dwnldFile","splashBg","head","bgImg","ap_splash_directory","backgroundImage","accentUrl","accentStyle","trackListDisplay","indx","li","a","numSpan","classList","add","titleWrprSpan","titleSpan","date","Date","year","getFullYear","ap_copyright","_setProgram","plyrControlsUrl","controls","Plyr","autoplay","volume","clickToPlay","fullscreen","enabled","fallback","iosNative","on","event","detail","plyr","playpauseBtn","muteUnmuteBtn","loopBtn","playbackRateBtn","i","options","Number","value","speed","selectedIndex","remove","loop","contains","restart","evt","target","ap_custom_themes","find","ap_logo_default","decorationBar","colors","hex","span","backgroundColor","hasCoreFeaturesSupport","showError","hasAppearanceIusses","showWarning","Modernizr","audio","json","svg","csscalc","flexbox","canvas","cssanimations","bgsizecover","objectfit","iconStr","titleStr","bodyStr","icon","ariaHidden","createAttribute","setAttributeNode","_fadeIn","str","hideTime","setTimeout","_fadeOut","closeBtn","closeProfile","showProfile","minDisplay","_hideCCSpectrum","_slideDown","parentNode","querySelectorAll","_slideUp","toggles","displays","toggleCC","toggleSpectrum","all","callback","request","XMLHttpRequest","open","onload","status","abort","onerror","send","found","arr","index","splice","test","pop","parts","split","lastIndexOf","_cleanArray","offsetWidth","scrollWidth","runTime","startTime","start","setInterval","width","clearInterval","stop","clearTimeout","animationEvt","_whichAnimationEvent","_event","_callback","_fadeCallback","removeEventListener","_slideCallback","ani","animations","animation","OAnimation","MozAnimation","WebkitAnimation","fn","attachEvent","readyState"],"mappings":"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","file":"audio.js","sourcesContent":["/*\n * Audio Player\n *\n * @author: Ethan Lin\n * @url: https://github.com/oel-mediateam/audioplayer\n * @version: 2.0.0\n *\n * @license: The MIT License (MIT)\n * Copyright (c) 2014 - 2018 Media Serivces\n *\n */\n\n'use strict';\n\nclass APlayer {\n    \n    constructor() {\n        \n        this.el = {\n            splash: '#ap-splash',\n            splashTitle: '#ap-splash .cover-info .title',\n            splashSubtitle: '#ap-splash .cover-info .subtitle',\n            splashAuthor: '#ap-splash .cover-info .author',\n            splashLength: '#ap-splash .cover-info .length',\n            startBtn: '#ap-start-btn',\n            resumeBtn: '#ap-resume-btn',\n            dwnldBtn: '#ap-dwnld-btn',\n            dwnldBtnMenu: '#ap-dwnld-btn .dropdown-content',\n            main: '#ap-main',\n            mainBody: '#ap-main .body',\n            showProfileBtn: '#show-profile',\n            closeProfileBtn: '#author-close-btn',\n            profileDisplay: '#author-overlay',\n            trackTitle: '.track-info .title-wrapper .title',\n            trackAuthor: '.track-info .author',\n            currentDuration: '.track-info .meta .duration',\n            currentTrackNum: '.track-info .meta .current',\n            totalTracks: '.track-info .meta .total',\n            miniDisplay: '.track-list .minimized-display',\n            trackList: '.track-list .tracks',\n            expandTracksBtn: '.track-list .expand-btn',\n            ccSpecDisplay: '.body .cc-spec-display',\n            spectrumDisplay: '.body .cc-spec-display .spectrum',\n            captionDisplay: '.body .cc-spec-display .caption',\n            bodyControls: '.body .controls',\n            ccToggle: '#cc-toggle',\n            spectrumToggle: '#spectrum-toggle',\n            warning: '.body .warning-msg',\n            error: '#ap-error',\n            errorIcon: '#ap-error .icon',\n            errorTitle: '#ap-error .title',\n            errorBody: '#ap-error .body',\n            playerId: '#player',\n            copyright: '.copyright p',\n            player: null\n        };\n        \n        this.manifest ={};\n        this.album = {\n            url: 'assets/album.xml',\n            program: {},\n            downloads: []\n        };\n        this.player = null;\n        this.reference = {\n            names: this._parseUri( window.location.href ),\n            params: new URLSearchParams( window.location.search )\n        };\n        \n        this.getManifest();\n        \n    }\n    \n    getManifest() {\n        \n        let self = this;\n        let manifestUrl = self._selector( '#ap-manifest' ).getAttribute( 'href' );\n        \n        self._requestFile( manifestUrl, function( xhr ) {\n            \n            self.manifest = JSON.parse( xhr.response );\n            \n            if ( self.manifest.ap_root_directory.length === 0 ) {\n        \n                self.manifest.ap_root_directory = 'source/';\n                \n            }\n            \n            self.setUIs();\n            \n        } );\n        \n    }\n    \n    setUIs() {\n        \n        let self = this;\n        let templateUrl = self.manifest.ap_root_directory + 'script/templates/apui.tpl';\n        \n        self._requestFile( templateUrl, function( xhr ) {\n            \n            let body = self._selector( 'body' );\n            const res = xhr.response.replace( /\\{([source)]+)\\}/ig, self.manifest.ap_root_directory );\n            \n            body.innerHTML += res;\n            \n            self.getAlbum();\n            \n            self._checkSupport();\n            self._setStartResumeListeners();\n            self._expandDownloadBtnMenu();\n            self._CCSpectrumDisplays();\n            self._expandTracksToggle();\n            self._setShowProfileListener();\n            \n        } );\n        \n    }\n    \n    _expandDownloadBtnMenu() {\n        \n        let self = this;\n        \n        let dwnldBtn = self._selector( self.el.dwnldBtn );\n        let btn = dwnldBtn.querySelector( 'button' );\n        let menu = self._selector( self.el.dwnldBtnMenu );\n        \n        dwnldBtn.addEventListener( 'mouseenter', function() {\n            \n            btn.setAttribute( 'aria-expanded', true );\n            menu.setAttribute( 'aria-expanded', true );\n            \n        } );\n        \n        dwnldBtn.addEventListener( 'mouseleave', function() {\n            \n            btn.setAttribute( 'aria-expanded', false );\n            menu.setAttribute( 'aria-expanded', false );\n            \n        } );\n        \n    }\n    \n    _setStartResumeListeners() {\n        \n        let self = this;\n        \n        let startBtn = self._selector( self.el.startBtn );\n        let resumeBtn = self._selector( self.el.resumeBtn );\n        \n        startBtn.addEventListener( 'click', function() {\n            \n            self.hideSplash();\n            \n            let currentTitle = self._selector( self.el.trackTitle );\n            \n            currentTitle.innerHTML = self.album.tracks[0].title;\n            \n            let currentAuthor = self._selector( self.el.trackAuthor );\n            \n            if ( self._isEmpty( self.album.tracks[0].author) ) {\n                \n                currentAuthor.innerHTML = self.album.author;\n                \n            } else {\n                \n                currentAuthor.innerHTML = self.album.tracks[0].author;\n                \n            }\n            \n            if ( self.album.tracks.length > 1 ) {\n                \n                let currentTrack = self._selector( self.el.currentTrackNum );\n                currentTrack.innerHTML = 1;\n                \n                let totalTracks = self._selector( self.el.totalTracks );\n                totalTracks.innerHTML = self.album.tracks.length;\n                \n            }\n            \n            if ( self.player.ready ) {\n                \n                self.player.source = {\n                    \n                    type: 'audio',\n                    title: self.album.tracks[0].title,\n                    sources: [\n                        \n                        {\n                            \n                            src: 'assets/audio/' + self.album.tracks[0].src,\n                            type: 'audio/mp3'\n                            \n                        }\n                        \n                    ]\n                    \n                }\n                    \n                self.player.once( 'canplay', function() {\n                    \n                    if ( self.album.tracks.length > 1 ) {\n                    \n                        self._selector( self.el.currentDuration ).innerHTML = self.player.duration;\n                    \n                    }\n                    \n                    //self.player.togglePlay();\n                    \n                } );\n                \n            }\n            \n            self._marqueeEl( currentTitle );\n            \n        } );\n        \n        resumeBtn.addEventListener( 'click', function() {\n            \n            self.hideSplash();\n            \n        } );\n        \n    }\n    \n    getAlbum() {\n        \n        let self = this;\n        \n        self._requestFile( self.album.url, function( xhr ) {\n            \n            const xml = xhr.responseXML;\n            const xmlSettings = self._xmlSelector( xml, 'album' );\n            const xmlSetup = self._xmlSelector( xml, 'setup' );\n            const xmlTracks = self._xmlSelector( xml, 'track', true );\n            \n            // settings\n            self.album.settings = {};\n            self.album.settings.accent = xmlSettings.getAttribute( 'accent' );\n            self.album.settings.splashFormat = xmlSettings.getAttribute( 'splashImgFormat' );\n            self.album.settings.imgFormat = xmlSettings.getAttribute( 'imgFormat' );\n            self.album.settings.analytics = xmlSettings.getAttribute( 'analytics' );\n            self.album.settings.version = xmlSettings.getAttribute( 'xmlVersion' );\n            \n            // setup\n            self.album.title = self._xmlSelector( xmlSetup, 'title' ).textContent;\n            self.album.subtitle = self._xmlSelector( xmlSetup, 'subtitle' ).textContent;\n            self.album.author = self._xmlSelector( xmlSetup, 'author' ).getAttribute( 'name' );\n            self.album.authorProfile = self._xmlSelector( xmlSetup, 'author' ).textContent;\n            self.album.length = self._xmlSelector( xmlSetup, 'length' ).textContent;\n            \n            // set program\n            if ( self._isEmpty( xmlSetup.getAttribute( 'program' ) ) ) {\n                \n                if ( self.reference.names[3] !== undefined ) {\n                    \n                    self.album.program.name = self.reference.names[3];\n                    \n                }\n                \n            } else {\n                \n                self.album.program.name = xmlSetup.getAttribute( 'program' );\n                \n            }\n            \n            // set course\n            if ( !self._isEmpty( xmlSetup.getAttribute( 'course' ) ) ) {\n                \n                self.album.program.course = xmlSetup.getAttribute( 'course' );\n                \n            }\n            \n            // track(s)\n            self.album.tracks = [];\n            \n            Array.prototype.forEach.call( xmlTracks, function( el) {\n                \n                let obj = {};\n            \n                obj.img = el.getAttribute( 'img' );\n                obj.src = el.getAttribute( 'src' );\n                obj.title = el.querySelector( 'title' ).innerHTML;\n                obj.author = el.querySelector( 'author' ).innerHTML;\n                \n                self.album.tracks.push( obj );\n                \n            } );\n            \n            console.log( self.album );\n            \n            self.setData();\n            self._setupAudioPlayer();\n            \n        } );\n        \n    }\n    \n    setData() {\n        \n        let self = this;\n        \n        // DOM head elements\n        let pageTitle = this._selector( 'title' );\n        \n        pageTitle.innerHTML = this.album.title;\n        \n        // splash screen\n        let title = this._selector( this.el.splashTitle );\n        let subtitle = this._selector( this.el.splashSubtitle );\n        let author = this._selector( this.el.splashAuthor );\n        let length = this._selector( this.el.splashLength );\n        \n        title.innerHTML = this.album.title;\n        subtitle.innerHTML = this.album.subtitle;\n        author.innerHTML = this.album.author;\n        length.innerHTML = this.album.length;\n        \n        // splash download menu list\n        let fileName = self.reference.names;\n        \n        if ( fileName.length === 0 ) {\n            \n            fileName = 'album';\n            \n        } else {\n            \n            fileName = self.reference.names[self.reference.names.length - 1];\n            \n        }\n        \n        Array.prototype.forEach.call( this.manifest.ap_download_files, function( el ) {\n            \n            let file = fileName + '.' + el.format;\n            \n            self._fileExists( file, function( exist ) {\n                \n                if ( exist ) {\n                    \n                    let link = document.createElement( 'a' );\n            \n                    link.href = file;\n                    link.setAttribute( 'download', file );\n                    link.setAttribute( 'role', 'menuitem' );\n                    link.innerHTML = el.label;\n                    \n                    let dwnldMenu = self._selector( self.el.dwnldBtnMenu );\n                    dwnldMenu.appendChild( link );\n                    \n                    let dwnldBtn = self._selector( self.el.dwnldBtn );\n                    dwnldBtn.setAttribute( 'aria-hidden', false );\n                    dwnldBtn.style.display = 'block';\n                    \n                    let dwnldFile = {\n                        name: el.label,\n                        url: file\n                    };\n                    \n                    self.album.downloads.push( dwnldFile );\n                    \n                }\n                \n            } );\n            \n        } );\n        \n        // splash background image\n        if ( !this._isEmpty( this.album.program.name ) ) {\n            \n            let splashBg = this._selector( this.el.splash );\n            let head = this._selector( 'head' );\n            \n            let bgImg = 'url(\"' + this.manifest.ap_splash_directory + this.album.program.name + '/default.' + this.album.settings.splashFormat + '\")';\n            \n            if ( !this._isEmpty( self.album.program.course ) ) {\n                \n                bgImg = 'url(\"' + this.manifest.ap_splash_directory + this.album.program.name + '/' + this.album.program.course + '.' + this.album.settings.splashFormat + '\")';\n                \n            }\n            \n            splashBg.style.backgroundImage = bgImg;\n            \n            // change the bg in the ap-main:before as well\n            let style = document.createElement( 'style' );\n            \n            style.setAttribute( 'type', 'text/css' );\n            style.innerHTML = '#ap-main:before{background-image: ' + bgImg + ' !important;}';\n            \n            head.appendChild( style );\n            \n        }\n        \n        // load accent\n        if ( !this._isEmpty( self.album.settings.accent ) ) {\n            \n            let accentUrl = this.manifest.ap_root_directory + 'script/templates/accent_css.tpl';\n            this._requestFile( accentUrl, function( xhr ) {\n                \n                const accentStyle = xhr.response.replace( /\\{([accent)]+)\\}/ig, self.album.settings.accent );\n                \n                let head = self._selector( 'head' );\n                let style = document.createElement( 'style' );\n                \n                style.setAttribute( 'type', 'text/css' );\n                style.innerHTML = accentStyle;\n                \n                head.appendChild( style );\n                \n            } );\n            \n        }\n        \n        // set tracks\n        if ( this.album.tracks.length > 1 ) {\n            \n            let trackListDisplay = this._selector( this.el.trackList );\n            \n            Array.prototype.forEach.call( this.album.tracks, function( el, indx ) {\n                \n                let li = document.createElement( 'li' );\n                let a = document.createElement( 'a' );\n                \n                a.href = 'javascript:void(0);';\n                a.setAttribute( 'data-src', el.src );\n                a.setAttribute( 'data-author', el.author );\n                a.setAttribute( 'data-img', el.img );\n                \n                let numSpan = document.createElement( 'span' );\n                \n                numSpan.classList.add( 'track-num' );\n                numSpan.innerHTML = indx + 1 + '. ';\n                \n                let titleWrprSpan = document.createElement( 'span' );\n                \n                titleWrprSpan.classList.add( 'track-title-wrapper' );\n                \n                let titleSpan = document.createElement( 'span' );\n                \n                titleSpan.classList.add( 'track-title' );\n                titleSpan.innerHTML = el.title;\n                \n                titleWrprSpan.appendChild( titleSpan );\n                \n                a.appendChild( numSpan );\n                a.appendChild( titleWrprSpan );\n                \n                li.appendChild( a );\n                \n                trackListDisplay.appendChild( li );\n                \n            } );\n            \n        } else {\n            \n            this._selector( this.el.main ).classList.add( 'single' );\n            \n        }\n    \n        // copyright\n        let copyright = this._selector( this.el.copyright );\n        let date = new Date();\n        let year = date.getFullYear();\n        \n        copyright.innerHTML += '&copy; ' + year + '. ' + this.manifest.ap_copyright;\n        \n        // program theme\n        this._setProgram();\n        \n    }\n    \n    _setupAudioPlayer() {\n        \n        let self = this;\n        \n        let plyrControlsUrl = self.manifest.ap_root_directory + 'script/templates/single_plyr_controls.tpl';\n        \n        if ( self.album.tracks.length > 1 ) {\n            \n            plyrControlsUrl = self.manifest.ap_root_directory + 'script/templates/full_plyr_controls.tpl';\n            \n        }\n        \n        self._requestFile( plyrControlsUrl, function( xhr ) {\n            \n            const controls = xhr.response.replace( /\\{([source)]+)\\}/ig, self.manifest.ap_root_directory );\n                \n            self.el.player = new Plyr( self.el.playerId, {\n        \n                controls: controls,\n                autoplay: false,\n                volume: 0.8,\n                clickToPlay: false,\n                fullscreen: {\n                    enabled: false,\n                    fallback: false,\n                    iosNative: false\n                }\n                            \n            } );\n            \n            self.el.player.on( 'ready', event => {\n                \n                self.player = event.detail.plyr;\n                \n                const playpauseBtn = self._selector( '#ap-playpause' );\n                const muteUnmuteBtn = self._selector( '#ap-muteunmute' );\n                const loopBtn = self._selector( '#ap-loop' );\n                const playbackRateBtn = self._selector( '#ap-playbackRate' );\n                \n                // check playback rate and update playback rate select element\n                for ( var i = 0; i < playbackRateBtn.options.length; i++ ) {\n    \n                    if ( Number( playbackRateBtn.options[i].value ) === self.player.speed ) {\n                        \n                        playbackRateBtn.selectedIndex = i;\n                        break;\n                        \n                    }\n                    \n                }\n                \n                self.player.on( 'playing', function() {\n                    \n                    playpauseBtn.classList.add( 'plyr__control--pressed' );\n                    \n                } );\n                \n                self.player.on( 'pause', function() {\n                    \n                    playpauseBtn.classList.remove( 'plyr__control--pressed' );\n                    \n                } );\n                \n                // on playback end\n                self.player.on( 'ended', function() {\n                    \n                    if ( self.player.loop === false ) {\n                        \n                        if ( playpauseBtn.classList.contains( 'plyr__control--pressed' ) ) {\n                    \n                            playpauseBtn.classList.add( 'plyr__control--pressed' );\n                            \n                        }\n                        \n                        self.player.restart();\n                        \n                    }\n                    \n                } );\n                \n                // toogle loop button state\n                loopBtn.addEventListener( 'click', function() {\n    \n                    if ( self.player.loop === false ) {\n                        \n                        self.player.loop = true;\n                        loopBtn.classList.add( 'active' );\n                        \n                    } else {\n                        \n                        self.player.loop = false;\n                        loopBtn.classList.remove( 'active' );\n                        \n                    }\n                    \n                } );\n                \n                // change playback rate\n                playbackRateBtn.addEventListener( 'change', function( evt ) {\n                    \n                    self.player.speed = Number( evt.target.options[evt.target.selectedIndex].value );\n                    \n                } );\n                \n                // toglle mute/unmute state\n                muteUnmuteBtn.addEventListener( 'click', function( evt ) {\n                    \n                    if ( evt.target.classList.contains( 'plyr__control--pressed' ) ) {\n                        \n                        evt.target.classList.remove( 'plyr__control--pressed' );\n                        \n                    } else {\n                        \n                        evt.target.classList.add( 'plyr__control--pressed' );\n                        \n                    }\n                    \n                } );\n                    \n            } ); // end player ready event\n            \n        } );\n        \n    } // end _setupAudioPlayer\n    \n    _setProgram() {\n        \n        let self = this;\n        \n        if ( self.manifest.ap_custom_themes ) {\n            \n            self.album.program = self.manifest.ap_custom_themes.find( function ( obj ) {\n                \n                return obj.name === self.album.program.name;\n                \n            } );\n            \n            if ( self.album.program === undefined ) {\n                \n                self.album.program = self.manifest.ap_custom_themes.find( function ( obj ) {\n                    \n                    return obj.name === self.manifest.ap_logo_default;\n                    \n                } );\n                \n            }\n            \n        }\n        \n        let decorationBar = self._selector( '.program-theme' );\n    \n        self.album.program.colors.forEach( function( hex ) {\n                        \n            let span = document.createElement( 'span' );\n            span.style.backgroundColor = hex;\n            decorationBar.appendChild( span );\n            \n        } );\n        \n    }\n    \n    _checkSupport() {\n        \n        if ( this.hasCoreFeaturesSupport() ) {\n        \n            this.showError( '🙈', '', 'Your web browser does not support core audio player features.<br><a href=\"http://outdatedbrowser.com/en\" target=\"_blank\">Please update your web browser.</a>' );\n            return;\n            \n        }\n        \n        if ( this.hasAppearanceIusses() ) {\n        \n            this.showWarning( 'For better viewing, try a different web browser.' );\n            \n        }\n        \n    }\n    \n    hasCoreFeaturesSupport() {\n    \n        if ( !Modernizr.audio && Modernizr.json && Modernizr.svg\n             && Modernizr.csscalc && Modernizr.flexbox ) {\n            return true;\n        }\n        \n        return false;\n        \n    }\n    \n    hasAppearanceIusses() {\n    \n        if ( !Modernizr.canvas ) {\n            return true;\n        }\n        \n        if ( !Modernizr.cssanimations ) {\n            return true;\n        }\n        \n        if ( !Modernizr.bgsizecover ) {\n            return true\n        }\n        \n        if ( !Modernizr.objectfit ) {\n            return true\n        }\n        \n        return false;\n        \n    }\n    \n    showError( iconStr, titleStr, bodyStr ) {\n    \n        let splash = this._selector( this.el.splash );\n        let main = this._selector( this.el.main );\n        let error = this._selector( this.el.error );\n        let icon = this._selector( this.el.errorIcon );\n        let title = this._selector( this.el.errorTitle );\n        let body = this._selector( this.el.errorBody );\n        \n        let ariaHidden = document.createAttribute( 'aria-hidden' );\n        \n        ariaHidden.value = false;\n        \n        icon.innerHTML = iconStr;\n        title.innerHTML = titleStr;\n        body.innerHTML = bodyStr;\n        \n        splash.style.display = 'none';\n        main.style.display = 'none';\n        \n        error.style.display = 'flex';\n        error.setAttributeNode( ariaHidden );\n        \n        this._fadeIn( error );\n        \n    }\n    \n    showWarning( str ) {\n    \n        let self = this;\n        let warning = self._selector( self.el.warning );\n        let hideTime = 6000;\n        \n        warning.innerHTML = str;\n        warning.style.display = 'block';\n        \n        self._fadeIn( warning );\n        \n        window.setTimeout( function() {\n            \n            self._fadeOut( warning, function() {\n                \n                warning.innerHTML = '';\n                warning.style.display = 'none';\n                \n            } );\n            \n        }, hideTime );\n        \n    }\n    \n    hideSplash() {\n    \n        let splash = this._selector( this.el.splash );\n        let ariaHidden = document.createAttribute( 'aria-hidden' );\n        \n        ariaHidden.value = true;\n        \n        splash.classList.add( 'hide-splash' );\n        splash.setAttributeNode( ariaHidden );\n        \n    }\n    \n    showProfile() {\n        \n        let self = this;\n        let authorProfile = this._selector( this.el.profileDisplay );\n        let closeBtn = this._selector( this.el.closeProfileBtn );\n        \n        authorProfile.style.display = 'block';\n        this._fadeIn( authorProfile );\n        \n        closeBtn.addEventListener( 'click', function() {\n            self.closeProfile();\n        }, {once: true} );\n\n    }\n    \n    closeProfile() {\n        \n        let authorProfile = this._selector( this.el.profileDisplay );\n        \n        this._fadeOut( authorProfile, function() {\n            \n            authorProfile.style.display = '';\n            \n        } );\n\n    }\n    \n    _setShowProfileListener() {\n        \n        let self = this;\n        let showProfileBtn = this._selector( this.el.showProfileBtn );\n        \n        showProfileBtn.addEventListener( 'click', function() {\n            \n            self.showProfile();\n            \n        } );\n        \n    }\n    \n    _expandTracksToggle() {\n        \n        let self = this;\n        let expandTracksBtn = self._selector( this.el.expandTracksBtn );\n        \n        expandTracksBtn.addEventListener( 'click', function() {\n            \n            let trackList = self._selector( self.el.trackList );\n            let minDisplay = self._selector( self.el.miniDisplay );\n            \n            if ( trackList.style.display == 'none' || trackList.style.display == '' ) {\n                \n                trackList.style.display = 'block';\n                minDisplay.style.display = 'none';\n                \n                self._hideCCSpectrum();\n                \n                self._slideDown( expandTracksBtn.parentNode, function() {\n                    \n                    expandTracksBtn.classList.add( 'rotate' );\n                    \n                } );\n                \n                let tracks = document.querySelectorAll( self.el.trackList + ' .track-title-wrapper .track-title' );\n                \n                Array.prototype.forEach.call( tracks, function( el ) {\n                    \n                    self._marqueeEl( el );\n                    \n                } );\n                \n            } else {\n                \n                trackList.style.display = 'none';\n                minDisplay.style.display = 'flex';\n                \n                self._slideUp( expandTracksBtn.parentNode, function() {\n                    \n                    expandTracksBtn.classList.remove( 'rotate' );\n                    self._CCSpectrumDisplays();\n                    \n                } );\n                \n            }\n            \n        } );\n        \n    }\n    \n    toggleCC() {\n        \n        let captionDisplay = this._selector( this.el.captionDisplay );\n        let spectrumDisplay = this._selector( this.el.spectrumDisplay );\n        let ccToggle = this._selector( this.el.ccToggle );\n        let spectrumToggle = this._selector( this.el.spectrumToggle );\n        \n        ccToggle.classList.add( 'disabled' );\n        spectrumToggle.classList.remove( 'disabled' );\n        \n        captionDisplay.classList.add( 'active' );\n        spectrumDisplay.classList.remove( 'active' );\n        \n    }\n    \n    toggleSpectrum() {\n        \n        let captionDisplay = this._selector( this.el.captionDisplay );\n        let spectrumDisplay = this._selector( this.el.spectrumDisplay );\n        let ccToggle = this._selector( this.el.ccToggle );\n        let spectrumToggle = this._selector( this.el.spectrumToggle );\n        \n        spectrumToggle.classList.add( 'disabled' );\n        ccToggle.classList.remove( 'disabled' );\n        \n        spectrumDisplay.classList.add( 'active' );\n        captionDisplay.classList.remove( 'active' );\n        \n    }\n    \n    _CCSpectrumDisplays() {\n        \n        let self = this;\n        let toggles = this._selector( this.el.bodyControls );\n        let displays = this._selector( this.el.ccSpecDisplay );\n        let ccToggle = this._selector( this.el.ccToggle );\n        let spectrumToggle = this._selector( this.el.spectrumToggle );\n        \n        if ( toggles.style.display === 'none' ) {\n            \n            toggles.style.display = '';\n            displays.style.display = '';\n            \n        } else {\n\n            self.toggleCC();\n            \n        }\n        \n        ccToggle.addEventListener( 'click', function() {\n            self.toggleCC();\n        } );\n        \n        spectrumToggle.addEventListener( 'click', function() {\n            self.toggleSpectrum();\n        } );\n        \n    }\n    \n    _hideCCSpectrum() {\n        \n        let displays = this._selector( this.el.ccSpecDisplay );\n        let toggles = this._selector( this.el.bodyControls );\n        \n        toggles.style.display = 'none';\n        displays.style.display = 'none';\n        \n    }\n    \n    /*** HELPER METHODS ***/\n    \n    _selector( str ) {\n        return document.querySelector( str );\n    }\n    \n    _xmlSelector( xml, str, all ) {\n        \n        all = typeof all === 'boolean' ? all : false;\n        \n        if ( all ) {\n            \n            return xml.querySelectorAll( str );\n            \n        } else {\n            \n            return xml.querySelector( str );\n            \n        }\n        \n    }\n    \n    _isEmpty( str ) {\n        \n        if ( str === '' ) {\n            return true;\n        }\n        \n        if ( str === undefined ) {\n            return true;\n        }\n        \n        if ( str ===  null ) {\n            return true;\n        }\n        \n        return false;\n        \n    }\n    \n    _requestFile( url, callback ) {\n        \n        let self = this;\n        let body = self._selector( 'body' );\n        let request = new XMLHttpRequest();\n        \n        request.open( 'GET', url, true );\n        \n        request.onload = function() {\n            \n            if ( this.status >= 200 && this.status < 400 ) {\n                \n                callback( this );\n                \n            } else {\n                \n                body.innerHTML += '<div class=\"error\">Error ' + this.status + ' while loading <code>' + url + '</code></div>';\n                \n            }\n            \n            request.abort();\n            \n        };\n        \n        request.onerror = function() {\n            \n            body.innerHTML += '<div class=\"error\">Connection Error. Check your network.</div>';\n            \n        };\n        \n        request.send();\n        \n    }\n    \n    _fileExists( url, callback ) {\n        \n        let request = new XMLHttpRequest();\n        let found = false;\n        \n        request.open( 'HEAD', url, true );\n        \n        request.onload = function() {\n            \n            if ( this.status >= 200 && this.status < 400 ) {\n                \n                found = true;\n                \n            } else {\n                \n                found = false;\n                \n            }\n            \n            callback( found );\n            \n        };\n        \n        request.send();\n        \n    }\n    \n    _cleanArray( arr ) {\n    \n        arr.forEach( function( value, index ) {\n            \n            if ( value === '' ) {\n                arr.splice( index, 1 );\n            }\n            \n        } );\n        \n        if ( ( /(\\w*|(\\w*\\-\\w*)*)\\.\\w*/ig ).test( arr[arr.length-1] ) ) {\n            arr.pop();\n        }\n        \n        if ( ( /(\\w*|(\\w*\\-\\w*)*)\\:/ig ).test( arr[arr.length-1] ) ) {\n            arr.pop();\n        }\n        \n        return arr;\n        \n    }\n    \n    _parseUri( str ) {\n        \n        let parts =  str.split( '?' );\n        let target = parts[0];\n        \n        if ( target.lastIndexOf( '/' ) !== target.length - 1 ) {\n    \t\ttarget += '/';\n    \t}\n    \t\n    \treturn this._cleanArray( target.split( '/' ) );\n        \n    }\n    \n    /*** ANIMATION METHODS ***/\n    \n    _marqueeEl( el ) {\n        \n        let self = this;\n        \n        if ( el.offsetWidth < el.scrollWidth ) {\n            \n            let runTime = 15500;\n            let startTime = 5000;\n            \n            let start = window.setInterval( function() {\n                \n                el.parentNode.classList.add( 'marquee' );\n                \n                el.style.width = el.scrollWidth + 'px';\n                \n                window.clearInterval( start );\n                \n                let stop = window.setTimeout( function() {\n                    \n                    el.style.width = 'initial';\n                    \n                    self._fadeIn( el );\n                    \n                    el.parentNode.classList.remove( 'marquee' );\n                    window.clearTimeout( stop );\n                    self._marqueeEl( el );\n                    \n                }, runTime );\n                \n            }, startTime );\n            \n        }\n        \n    }\n    \n    _fadeIn( el, callback ) {\n        \n        el.classList.remove( 'fadeOut' );\n        el.classList.add( 'fadeIn' );\n        \n        let animationEvt = this._whichAnimationEvent();\n        \n        el.params = {\n            _event: animationEvt,\n            _callback: callback\n        };\n        \n        el.addEventListener( animationEvt, this._fadeCallback );\n        \n    }\n    \n    _fadeOut( el, callback ) {\n\n        el.classList.remove( 'fadeIn' );\n        el.classList.add( 'fadeOut' );\n        \n        let animationEvt = this._whichAnimationEvent();\n        \n        el.params = {\n            _event: animationEvt,\n            _callback: callback\n        };\n        \n        el.addEventListener( animationEvt, this._fadeCallback );\n        \n    }\n    \n    _fadeCallback( evt ) {\n        \n        if ( evt.target.params._callback !== undefined ) {\n            \n            if ( typeof evt.target.params._callback === 'function' ) {\n                \n                evt.target.params._callback();\n                \n            }\n            \n        }\n        \n        evt.target.classList.remove( 'fadeIn' );\n        evt.target.classList.remove( 'fadeOut' );\n        evt.target.removeEventListener( evt.target.params._event, this._fadeCallback );\n        \n    }\n    \n    _slideDown( el, callback ) {\n        \n        el.classList.add( 'slideDown' );\n        el.classList.remove( 'slideUp' );\n        \n        let animationEvt = this._whichAnimationEvent();\n        \n        el.params = {\n            _event: animationEvt,\n            _callback: callback\n        };\n        \n        el.addEventListener( animationEvt, this._slideCallback );\n        \n    }\n    \n    _slideUp( el, callback ) {\n        \n        el.classList.add( 'slideUp' );\n        el.classList.remove( 'slideDown' );\n        \n        let animationEvt = this._whichAnimationEvent();\n        \n        el.params = {\n            _event: animationEvt,\n            _callback: callback\n        };\n        \n        el.addEventListener( animationEvt, this._slideCallback );\n        \n    }\n    \n    _slideCallback( evt ) {\n        \n        if ( evt.target.params._callback !== undefined ) {\n            \n            if ( typeof evt.target.params._callback === 'function' ) {\n                \n                evt.target.params._callback();\n                \n            }\n            \n        }\n        \n        evt.target.removeEventListener( evt.target.params._event, this._slideCallback );\n        \n    } \n    \n    _whichAnimationEvent() {\n        \n        let ani;\n        let el = document.createElement( 'fakeelement' );\n        let animations = {\n            'animation': 'animationend',\n            'OAnimation': 'oAnimationEnd',\n            'MozAnimation': 'animationend',\n            'WebkitAnimation': 'webkitAnimationEnd'\n        }\n        \n        for ( ani in animations ) {\n            \n            if ( el.style[ani] !== undefined ) {\n                \n                return animations[ani];\n                \n            }\n            \n        }\n        \n    }\n    \n} // end APlayer class\n\n/**** ON DOM READY ****/\n( function ready( fn ) {\n    \n    if ( document.attachEvent ? document.readyState === 'complete' : document.readyState !== 'loading' ) {\n        \n        fn();\n        \n    } else {\n        \n        document.addEventListener( 'DOMContentLoaded', fn );\n        \n    }\n    \n} )( function() {\n    \n    new APlayer();\n    \n} );\n"]}